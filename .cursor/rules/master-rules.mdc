---
description: Master coding rules checklist - always check first
globs: 
alwaysApply: true
---

# üö® MASTER RULES - ALWAYS CHECK FIRST

## MANDATORY Before Any Code Changes

### 1. ALWAYS READ THESE RULES FIRST

- `.cursor/rules/home-assistant-standards.mdc` - HA integration standards
- `.cursor/rules/econet300-specific.mdc` - Device-specific guidelines
- `.cursor/rules/python-standards.mdc` - Python coding standards
- `.cursor/rules/translation-requirements.mdc` - Translation requirements
- `.cursor/rules/code-style-ruff.mdc` - **Code formatting with Ruff** üö®
- `.cursor/rules/api-endpoint-validation.mdc` - **API response validation** üö®
- `docs/DYNAMIC_ENTITY_VALIDATION.md` - **Dynamic entity validation layer** üÜï
- `docs/MIGRATION.md` - **Version migration guide for users** üÜï

### 2. ALWAYS FOLLOW HA DOCUMENTATION

- Reference: <https://developers.home-assistant.io/docs/development_index>
- Use proper entity lifecycle patterns
- Follow HA integration development guidelines

### 3. ALWAYS CHECK TRANSLATIONS

- Update `strings.json`, `en.json`, and `pl.json` for new entities
- Use camel_to_snake format for translation keys
- Test translations after changes

### 4. ALWAYS VALIDATE API ENDPOINTS

- **ALWAYS check test fixtures** in `tests/fixtures/` before documenting
- **Verify entity types** against actual JSON responses
- **Use fixture data** as source of truth for API behavior
- **Never document without checking** actual response examples

### 5. ALWAYS USE PROPER PATTERNS

- **DRY (Don't Repeat Yourself)** - Extract common functionality, avoid duplicate code
- **KISS (Keep It Simple, Stupid)** - Prefer simple, readable solutions over complex ones
- Use proper error handling
- Test your changes
- Use Ruff for code formatting and linting

### 6. üö® CRITICAL CODE STYLE RULES

- **ALWAYS use Ruff** for formatting and linting
- **NEVER use Black, isort, or flake8**
- **ALWAYS sort imports alphabetically** within groups
- **NEVER have whitespace in blank lines** (W293 rule)
- **ALWAYS run `ruff check .` before committing**

### 7. üìù MARKDOWNLINT RULES FOR DOCUMENTATION

When writing or editing Markdown files (`.md`), follow these rules:

**MD040 - Fenced code blocks must have language:**

- ‚úÖ CORRECT: Use triple backticks with language like `python`, `bash`, `json`, `text`
- ‚ùå WRONG: Triple backticks without any language specifier

**Use these language tags:**

- `python` - Python code
- `bash` - Shell commands
- `json` - JSON data
- `yaml` - YAML config
- `text` - Plain text, URLs, directory structures

**MD033 - HTML in Markdown:**

- Use `<b>text</b>` instead of `**text**` inside HTML tags like `<summary>`
- Example: `<summary><b>Click to expand</b></summary>` ‚úÖ
- NOT: `<summary>**Click to expand**</summary>` ‚ùå

**MD060 - Table formatting:**

- Tables must have consistent column alignment
- Add spaces around pipe characters
- Separator row must match header width

```markdown
# ‚úÖ CORRECT
| Column 1 | Column 2 | Column 3 |
| -------- | -------- | -------- |
| Value 1  | Value 2  | Value 3  |

# ‚ùå WRONG - inconsistent spacing
|Column 1|Column 2|Column 3|
|--------|--------|--------|
|Value 1|Value 2|Value 3|
```

**MD036 - No emphasis as heading:**

- Don't use `*text*` or `_text_` alone on a line as a pseudo-heading
- Use proper headings (`#`, `##`, etc.) or HTML comments for footers

**MD047 - Files must end with newline:**

- Always ensure markdown files end with a single newline character

**General Rules:**

- No trailing whitespace on lines
- Blank lines should be completely empty (no spaces/tabs)
- One blank line before and after code blocks
- One blank line before and after headings

### 8. ALWAYS CHECK BEFORE COMMITTING

- Run `ruff check .` to catch style issues
- Run `ruff format .` to auto-format code
- Ensure no import sorting issues
- Ensure no blank line whitespace issues
- **Validate API documentation** against test fixtures
- **Check markdown files** pass markdownlint
- Test your changes work as expected

### 9. üìù COMMIT MESSAGE GUIDELINES

- **Keep commit messages SHORT and concise** (50 chars or less for subject)
- **Use conventional commit format**: `type: short description`
- **Types**: `feat`, `fix`, `refactor`, `docs`, `test`, `chore`
- **NO periods** at the end of commit messages
- **Use imperative mood**: "Add feature" not "Added feature"

**Examples:**

```text
feat: add mixer temperature sensor
fix: handle null values in API response
refactor: simplify entity creation logic
docs: update translation reference
test: add fixtures for ecoMAX360
chore: update dependencies
```

**Avoid:**

- ‚ùå Long commit messages with excessive details
- ‚ùå Vague messages like "fix bug" or "update code"
- ‚ùå Multiple unrelated changes in one commit

### 10. DYNAMIC ENTITY CHANGES

When modifying dynamic entity creation from `mergedData` API:

- **Read**: `docs/DYNAMIC_ENTITY_VALIDATION.md` first
- **Update**: Documentation if adding new entity types or validation
- **Test**: Run `pytest tests/test_validation_functions.py -v`
- **Check**: Validation functions in `common_functions.py`
- **Verify**: Lock handling in entity classes (number.py, switch.py, select.py)
